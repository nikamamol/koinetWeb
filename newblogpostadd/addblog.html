<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Blog</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .tox-tinymce {
            border-radius: 20px;
        }
        
        body {
            /* background-color: #F5F5F5; */
        }
    </style>
    <script src="https://cdn.tiny.cloud/1/fqzuwll7ascld9x8g3841pclczljcxkx9twy3pmx7lwswiey/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
</head>

<body>
    <div class="container mt-5">
        <div class="row">
            <div class="sticky-top text-end">
                <button id="logoutButton" class="btn btn-warning rounded-3">Log Out</button>
            </div>

            <div class="text-center my-4">
                <p class="display-4 fw-bo ld text-dark"><span class="text-red">C</span>reate <span class="text-red">B</span>log!</p>

            </div>
            <div class="col-lg-4 col-sm-12">
                <div class="card rounded-4 border-0 shadow">

                    <div class="card-body text-center">
                        <h5 class="card-title">Total Blog</h5>
                        <p id="total-blogs" class="card-text fs-1 fw-bold">Loading...</p>
                        <a href="../blog.html" class="btn btn-primary">View All Blogs</a>
                    </div>

                </div>
            </div>
            <div class="col-lg-4 col-sm-12">
                <!-- <div class="card rounded-4 border-0 shadow">

                    <div class="card-body">
                        <h5 class="card-title">Special title treatment</h5>
                        <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                        <a href="#" class="btn btn-primary">Go somewhere</a>
                    </div>
                </div> -->
            </div>
            <div class="col-lg-4 col-sm-12">
                <div class="text-center">

                    <a class="btn btn-danger btn-lg rounded-5" href="../newblogpostadd/addblog.html">Add Blog +</a>
                </div>
            </div>
        </div>
    </div>
    <div class="container mt-4">
        <div class="row">
            <div class="col-lg-12">

                <form id="myForm">
                    <div class="form-group">
                        <label for="title">Title</label>
                        <input type="text" class="form-control" id="title" name="title" required>
                    </div>
                    <div class="form-group my-3">
                        <label for="category" class="mb-1">Category</label>
                        <select class="form-control" id="category" name="category" required>
                            <option value="">Select Category</option>
                            <option value="AI/ML">AI/ML</option>
                            <option value="Advertising">Advertising</option>
                            <option value="HR">HR</option>
                            <option value="B2B">B2B</option>
                            <option value="Business">Business</option>
                            <option value="Big Data">Big Data</option>
                            <option value="Digital">Digital</option>
                            <option value="Finance">Finance</option>
                            <option value="Education">Education</option>
                            <option value="Automotive">Automotive</option>
                            <option value="Internet services">Internet services</option>
                            <option value="Content Marketing">Content Marketing</option>
                            <option value="Customer Experience Management">Customer
                              Experience Management</option>
                            <option value="Digital Asset Management">Digital Asset
                              Management</option>
                            <option value="Lead Generation">Lead Generation</option>
                            <option value="Lead Generation">Information Technology</option>
                            <option value="Demand Generation">Demand Generation</option>
                            <option value="Identity Management">Identity Management</option>
                            <option value="Analytics">Analytics</option>
                            <option value="Automation">Automation</option>
                            <option value="Business Intelligence">Business Intelligence</option>
                            <option value="Content Syndication">Content Syndication</option>
                            <option value="Customer Identity Management">Customer Identity
                              Management</option>
                            <option value="Ecommerce and Mobile Ecommerce">Ecommerce and
                              Mobile Ecommerce</option>
                            <option value="Intelligent Assistants">Intelligent Assistants</option>
                            <option value="Apps for Business">Apps for Business</option>
                            <option value="B2B Data">B2B Data</option>
                            <option value="Collaboration">Collaboration</option>
                            <option value="Customer Acquisition">Customer Acquisition</option>
                            <option value="Customer Relationship Management">Customer
                              Relationship Management</option>
                            <option value="Email Marketing">Email Marketing</option>
                            <option value="Interactive Content">Interactive Content</option>
                            <option value="Audience Data">Audience Data</option>
                            <option value="Behavioral Marketing">Behavioral Marketing</option>
                            <option value="Communications">Communications</option>
                            <option value="Customer Data Platforms">Customer Data
                              Platforms</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Marketing">Marketing</option>
                            <option value="AR/VR">AR/VR</option>
                            <option value="Brand Safety">Brand Safety</option>
                            <option value="Content Management">Content Management</option>
                            <option value="Customer Engagement">Customer Engagement</option>
                            <option value="Digital Transformation">Digital Transformation</option>
                            <option value="Natural Language Processing">Natural Language
                              Processing</option>
                        </select>
                    </div>
                    <div class="form-group my-3">
                        <label for="imageUrl">Image URL</label>
                        <input type="text" class="form-control" id="imageUrl" name="imageUrl" required>
                    </div>
                    <textarea id="myTextarea" name="content" required>Create Your Blog!</textarea>
                    <div class="text-center my-2">
                        <button type="submit" class="btn btn-danger w-25 rounded-5 btn-lg">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Initialize TinyMCE editor
        tinymce.init({
            selector: 'textarea',
            plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount checklist mediaembed casechange export formatpainter pageembed linkchecker a11ychecker tinymcespellchecker permanentpen powerpaste advtable advcode editimage advtemplate ai mentions tinycomments tableofcontents footnotes mergetags autocorrect typography inlinecss markdown',
            toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat',
            tinycomments_mode: 'embedded',
            tinycomments_author: 'Author name',
            mergetags_list: [{
                value: 'First.Name',
                title: 'First Name'
            }, {
                value: 'Email',
                title: 'Email'
            }],
            ai_request: (request, respondWith) => respondWith.string(() => Promise.reject("See docs to implement AI Assistant")),
            content_css: "path/to/your/custom.css" // Path to your custom CSS file
        });

        // Form submission handler
        document.getElementById('myForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission
            const title = document.getElementById('title').value;
            const category = document.getElementById('category').value;
            const imageUrl = document.getElementById('imageUrl').value;
            const content = tinymce.get('myTextarea').getContent(); // Get content from TinyMCE editor

            const postData = {
                title,
                category,
                imageUrl,
                content
            };

            console.log(postData); // Debugging: log the payload

            fetch('https://koinetwebbackend.onrender.com/api/addblog', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('RegisterUser')}`
                    },
                    body: JSON.stringify(postData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                    } else {
                        alert('Blog created successfully!');
                        // Optionally, redirect to the blog page or clear the form
                        document.getElementById('myForm').reset()
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while creating the blog.');
                });
        });

        // Function to check if user is authenticated (has token in localStorage)
        const isAuthenticated = () => {
            return localStorage.getItem('registredUserLoginToken') !== null;
        };

        // On page load, check authentication status and initialize form
        document.addEventListener('DOMContentLoaded', () => {
            if (!isAuthenticated()) {
                window.location.href = 'login.html'; // Redirect to login page if not authenticated
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            // URL of your API endpoint
            const apiUrl = 'https://koinetwebbackend.onrender.com/api/getblogs';

            // Function to fetch the total number of blogs
            async function fetchTotalBlogs() {
                try {
                    const response = await fetch(apiUrl);
                    const data = await response.json();

                    // Assuming the API returns an array of blogs
                    const totalBlogs = data.length;

                    document.getElementById('total-blogs').textContent = totalBlogs;
                } catch (error) {
                    console.error('Error fetching total blogs:', error);
                    document.getElementById('total-blogs').textContent = 'Error';
                }
            }

            fetchTotalBlogs();
        });

        //logout button 
        const logoutButton = document.getElementById('logoutButton');

        // Add an event listener to the button
        logoutButton.addEventListener('click', () => {
            localStorage.removeItem('registredUserLoginToken'); // Remove the token from localStorage
            window.location.href = 'login.html'; // Redirect to the login page
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>

</html>